<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Calibrate Airport Size</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="calibrate_airport_size_files/libs/clipboard/clipboard.min.js"></script>
<script src="calibrate_airport_size_files/libs/quarto-html/quarto.js"></script>
<script src="calibrate_airport_size_files/libs/quarto-html/popper.min.js"></script>
<script src="calibrate_airport_size_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="calibrate_airport_size_files/libs/quarto-html/anchor.min.js"></script>
<link href="calibrate_airport_size_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="calibrate_airport_size_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="calibrate_airport_size_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="calibrate_airport_size_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="calibrate_airport_size_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Calibrate Airport Size</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>The purpose of this notebook is to find reasonable parameter settings to model airport size.</p>
<p>Airport size could theoretically be modeled several ways. The key idea in the model is that an airport’s size should be related to its maximum capacity for flight. This might be considered as:</p>
<ul>
<li><p>Count of departing flights in a period</p></li>
<li><p>Count of inbound and outbound flights in a period</p></li>
<li><p>Count of enplanements in a period</p></li>
<li><p>Count of inbound and outbound passengers in a period</p></li>
<li><p>Sum of available seat-miles over a period of time</p></li>
<li><p>Sum of passenger-miles over a period of time : <span class="math inline">\(\text{flight distance}\times \text{passengers on flight}\)</span></p></li>
</ul>
<p>The last two methods may have the advantage of being multidimensional because it can not only account for flights and passengers combined, which may say something about the size of aircraft. Available seat-miles might best represent capacity. Unfortunately, the focus on passengers excludes cargo flights, and this may be significant category that should be incorporated.</p>
<p>The operating theory in the model is that as hydrogen-powered flight becomes more prominent, adoption of hydrogen infrastructure can help airports make the most of their capacity as the potential hydrogen-based passenger miles increases in the amount of hydrogen flight demanded by airlines and the number of other connecting airports with hydrogen infrastructure (the proportion of airports adopting hydrogen).</p>
<section id="data-sources" class="level3">
<h3 class="anchored" data-anchor-id="data-sources">Data Sources</h3>
<p>Existing data on passengers, flights, revenue passenger-miles, and available seat-miles are available over time through BTS. A somewhat detailed view of each airport is available individually in their Data Elements view, but it appears that the data must be downloaded individually for each airport. This would require a significant investment of time to download, organize, process, and combine. <a href="https://www.transtats.bts.gov/Data_Elements.aspx?Qn6n=I" class="uri">https://www.transtats.bts.gov/Data_Elements.aspx?Qn6n=I</a>.</p>
<section id="t-100-market-data" class="level4">
<h4 class="anchored" data-anchor-id="t-100-market-data">T-100 Market Data</h4>
<p>Alternatively, we can calculate some of these measures ourselves using the T-100 market data also provided by the BTS. [<a href="https://www.transtats.bts.gov/Fields.asp?gnoyr_VQ=FMF" class="uri">https://www.transtats.bts.gov/Fields.asp?gnoyr_VQ=FMF</a>]. Data from transtat system at the Bureau of Transportation Statistics (BTS) at the Department of Transportation. Contains information about flights between most all destinations (domestic and international). Distance and number of passengers is included allowing the computation of revenue passenger miles (<code>T_T100_MARKET_ALL_CARRIER.csv</code>).</p>
<p>We can also use a lookup table of airport ID and name codes along with what country the airport is in so we can filter out non-us airports. The data also comes from BTS DOT TransStat system (<code>T_MASTER_CORD.csv</code>).</p>
<p>Below we read in the data and ensure any purely international flights are removed, by keeping only flights where the origin or destination airports are in the United States. Furthermore, we will create a new column names <code>domestic</code> which indicates a flight where both the origin and destination airports are located in the US.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggthemes)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"../data/airports/T_T100_MARKET_ALL_CARRIER.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(DEST_COUNTRY <span class="sc">==</span> <span class="st">"US"</span> <span class="sc">|</span> ORIGIN_COUNTRY <span class="sc">==</span> <span class="st">"US"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">domestic =</span> <span class="fu">ifelse</span>(DEST_COUNTRY<span class="sc">==</span><span class="st">"US"</span> <span class="sc">&amp;</span> ORIGIN_COUNTRY<span class="sc">==</span><span class="st">"US"</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We read in the airport identifying data and filter for US airports and creating a list of distinct airport ID and airport name (three letter code). It appears that airport ID should be unique and persistent over time, while the letter code name of an airport can change over time and is not guaranteed to be unique.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load airport code support table</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>aircode <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">"../data/airports/T_MASTER_CORD.csv"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>airport_names <span class="ot">=</span> aircode <span class="sc">%&gt;%</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(AIRPORT_COUNTRY_CODE_ISO <span class="sc">==</span> <span class="st">"US"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(AIRPORT_ID, AIRPORT) <span class="sc">%&gt;%</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co">#aircode = aircode %&gt;% select(AIRPORT_ID, AIRPORT_COUNTRY_CODE_ISO)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="flight-counts" class="level3">
<h3 class="anchored" data-anchor-id="flight-counts">Flight Counts</h3>
<p>As described earlier, one potential measure of airport size is the quantity of flights (inbound, outbound, or both). We proceed by counting the number of flights for which each airport is the origin, and for which each airport is the destination, and then combine the data to achieve a flight count data set.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Count the flights for each origin airport</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>orig_flight_counts <span class="ot">=</span> df <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(DISTANCE <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ORIGIN_AIRPORT_ID) <span class="sc">%&gt;%</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">orig_flight_count =</span> <span class="fu">n</span>())</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Count the flights for each destination airport</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>dest_flight_counts <span class="ot">=</span> df <span class="sc">%&gt;%</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(DISTANCE <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(DEST_AIRPORT_ID) <span class="sc">%&gt;%</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">dest_flight_count =</span> <span class="fu">n</span>())</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the origin and flight count datasets</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co"># merge in the airport name and country information</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co"># and filter out non US airports (if any).</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>orig_flight_counts <span class="sc">%&gt;%</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(dest_flight_counts, <span class="at">by =</span> <span class="fu">join_by</span>(ORIGIN_AIRPORT_ID <span class="sc">==</span> DEST_AIRPORT_ID)) <span class="sc">%&gt;%</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">flight_count =</span> orig_flight_count <span class="sc">+</span> dest_flight_count) <span class="sc">%&gt;%</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">'airport_id'</span> <span class="ot">=</span> <span class="st">'ORIGIN_AIRPORT_ID'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(aircode, <span class="at">by =</span> <span class="fu">join_by</span>(airport_id <span class="sc">==</span> AIRPORT_ID)) <span class="sc">%&gt;%</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(AIRPORT_COUNTRY_CODE_ISO <span class="sc">==</span> <span class="st">"US"</span>) <span class="ot">-&gt;</span> airport_flight_counts</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove any duplicated rows</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>airport_flight_counts <span class="ot">=</span> airport_flight_counts[<span class="sc">!</span><span class="fu">duplicated</span>(airport_flight_counts), ]</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Reduce the flight count dataframe to only</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="co"># the airport ID and the count of total flights</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="co"># both inbound and outbound. Keep only distinct</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="co"># combinations.</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>airport_flight_counts <span class="ot">=</span> airport_flight_counts <span class="sc">%&gt;%</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(airport_id, flight_count) <span class="sc">%&gt;%</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The flight count data is heavily skewed and visual inspection is difficult to decipher. Below we look at a quick descriptive summary of the flight count distribution and compute a proportional measure of the 3rd quartile for visualization purposes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>q3_count <span class="ot">=</span> <span class="fu">quantile</span>(airport_flight_counts<span class="sc">$</span>flight_count, <span class="fl">0.75</span>)<span class="sc">*</span><span class="dv">7</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>s_flight_count <span class="ot">=</span> <span class="fu">summary</span>(airport_flight_counts<span class="sc">$</span>flight_count)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(s_flight_count)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    2.0     9.0    52.0   459.5   180.5 16717.0 </code></pre>
</div>
</div>
<p>From the above description we see the extremely large gap between the smallest and largest airports. The minimum flight value of 2 flights compared to almost 17,000 flights on the high-end. The large difference in median and mean again reflects the extreme right-skew.</p>
<p>Below is a density plot of the distribution of flight counts for 2023 with the population filtered for flight counts less than <code>q3_count</code> . This eliminates the largest airports to decrease the skew and yield a better picture of the lower-end of the distribution. Removing the filter condition will show the full distribution.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">filter</span>(airport_flight_counts, flight_count <span class="sc">&lt;</span> q3_count)) <span class="sc">+</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> s_flight_count[[<span class="dv">3</span>]], <span class="at">color =</span> <span class="st">"skyblue3"</span>) <span class="sc">+</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">round</span>(s_flight_count[[<span class="dv">3</span>]],<span class="dv">0</span>)<span class="sc">*</span><span class="fl">1.4</span>, </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">y =</span> <span class="dv">0</span>, </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">label =</span> <span class="fu">round</span>(s_flight_count[[<span class="dv">3</span>]],<span class="dv">0</span>)),</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"skyblue3"</span>) <span class="sc">+</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> s_flight_count[[<span class="dv">4</span>]], <span class="at">color =</span> <span class="st">"coral3"</span>) <span class="sc">+</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">round</span>(s_flight_count[[<span class="dv">4</span>]],<span class="dv">0</span>)<span class="sc">*</span><span class="fl">1.07</span>, </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">y =</span> <span class="dv">0</span>, </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">label =</span> <span class="fu">round</span>(s_flight_count[[<span class="dv">4</span>]],<span class="dv">0</span>)),</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"coral3"</span>) <span class="sc">+</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> flight_count, <span class="at">y =</span> <span class="fu">after_stat</span>(density)),</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"aquamarine4"</span>,</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribution of Flight Counts for 2023"</span>,</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Number of inbound &amp; outbound flights"</span>,</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Density"</span>) <span class="sc">+</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_clean</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="calibrate_airport_size_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="passenger-miles" class="level3">
<h3 class="anchored" data-anchor-id="passenger-miles">Passenger Miles</h3>
<p>To create the distribution of passenger miles, we can follow a similar approach used for flight counts. Passenger miles will be calculated for each flight in the data as the distance (in miles) of the flight multiplied by the number of passengers aboard the flight. Passenger miles will be calculated for airports as the origin, the destination, and then combined for overall passenger miles associated with an airport.</p>
<p>Upon several iterations and investigation, it seemed reasonable that only considering passenger miles originating from an airport to be most relevant for provided aeronautical services and should avoid double counting.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the originating passenger-miles</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># for each airport</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>orig_pm <span class="ot">=</span> df <span class="sc">%&gt;%</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(DISTANCE <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> PASSENGERS <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">passenger_miles =</span> DISTANCE <span class="sc">*</span> PASSENGERS) <span class="sc">%&gt;%</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ORIGIN_AIRPORT_ID) <span class="sc">%&gt;%</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">orig_pm =</span> <span class="fu">sum</span>(passenger_miles))</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the destination passenger-miles</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co"># for each airport</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>dest_pm <span class="ot">=</span> df <span class="sc">%&gt;%</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(DISTANCE <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> PASSENGERS <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">passenger_miles =</span> DISTANCE <span class="sc">*</span> PASSENGERS) <span class="sc">%&gt;%</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(DEST_AIRPORT_ID) <span class="sc">%&gt;%</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">dest_pm =</span> <span class="fu">sum</span>(passenger_miles))</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the origin and destination data into</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="co"># a single dataframe, and then join in airport</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="co"># name and location data to filter out any</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="co"># non-US airports. Finally select only a </span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="co"># list of airport ID, character code, and originating</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="co"># passenger-miles</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>orig_pm <span class="sc">%&gt;%</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(dest_pm, <span class="at">by =</span> <span class="fu">join_by</span>(ORIGIN_AIRPORT_ID <span class="sc">==</span> DEST_AIRPORT_ID)) <span class="sc">%&gt;%</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">passenger_miles =</span> orig_pm <span class="sc">+</span> dest_pm) <span class="sc">%&gt;%</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">'airport_id'</span> <span class="ot">=</span> <span class="st">'ORIGIN_AIRPORT_ID'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(aircode, <span class="at">by =</span> <span class="fu">join_by</span>(airport_id <span class="sc">==</span> AIRPORT_ID)) <span class="sc">%&gt;%</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(AIRPORT_COUNTRY_CODE_ISO <span class="sc">==</span> <span class="st">"US"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(airport_id, AIRPORT, orig_pm) <span class="ot">-&gt;</span> airport_pm</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove any duplicated rows</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>airport_pm <span class="ot">=</span> airport_pm[<span class="sc">!</span><span class="fu">duplicated</span>(airport_pm), ]</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Write the dataframe to a CSV file for later merging</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(airport_pm, <span class="st">"../data/airports/airport_pm.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A quick descriptive summary of the distribution of passenger-miles is shown below, along with calculation of the 3rd quartile for visualization purposes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>s <span class="ot">=</span> <span class="fu">summary</span>(airport_pm<span class="sc">$</span>orig_pm)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>q3 <span class="ot">=</span> <span class="fu">quantile</span>(airport_pm<span class="sc">$</span>orig_pm, <span class="fl">0.75</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">format</span>(s, <span class="at">scientific=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         Min.       1st Qu.        Median          Mean       3rd Qu. 
"         11" "       7652" "     224501" "  999469355" "   11651534" 
         Max. 
"85534859450" </code></pre>
</div>
</div>
<p>As with flight counts, the distribution has an extremely long right-tail, a fact further borne out in the density plot. With such large outliers, it may be appropriate to remove them to investigate their impact. The code below, if ran, removes outliers using the <span class="math inline">\(1.5 \times IQR\)</span> rule-of-thumb. Where outliers further way from central tendency then 1.5 times the interquartile range (IQR) are removed from the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove outliers (1.5 x interquartile range)</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>pm_outliers <span class="ot">&lt;-</span> <span class="fu">boxplot</span>(airport_pm<span class="sc">$</span>orig_pm, <span class="at">plot =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>out</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>airport_pm <span class="ot">&lt;-</span> airport_pm[<span class="sc">-</span><span class="fu">which</span>(airport_pm<span class="sc">$</span>orig_pm <span class="sc">%in%</span> pm_outliers), ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(airport_pm) <span class="sc">+</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> orig_pm, <span class="at">y =</span> <span class="fu">after_stat</span>(density)),</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribution of Passenger-Miles for 2023"</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Annual passenger-miles per airport"</span>,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Originating passenger-miles"</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Density"</span>) <span class="sc">+</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_clean</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="calibrate_airport_size_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The density pattern above is quite consistent with flight counts. While difficult to see in the plot, the mode of the density curve is not actually at zero or even the minimum value. However, the mode is close to the minimum value and a number of different known probability distributions might be used to model this. A couple of reasonable candidates may be a Gamma distribution or a Pareto distribution. Though other distributions that can handle the long (possibly fat) tail optimally could be considered.</p>
<p>The Pareto distribution has the advantage of setting the minimum value above zero and being quite simple, but comes at the cost of forcing the mode to be equal to the minimum. This may be a reasonable approximation in this case, however.</p>
<p>The Gamma distribution has the advantage of not forcing the mode to equal the minimum and can incorporate a broader range of distribution shapes. Quick estimation of the distribution parameters using approximate maximum likelihood and also method-of-moments techniques yield a shape parameter suggesting a mode of zero. While this doesn’t match the sample data precisely, it may not ultimately be a terrible approximation, more research is needed here.</p>
<p>The general empirical moments form the sample are printed below. Remember to check if outliers have been removed from the sample when using these numbers.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First two sample moments about the mean.</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>pm_min <span class="ot">=</span> <span class="fu">min</span>(airport_pm<span class="sc">$</span>orig_pm)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>pm_max <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">max</span>(airport_pm<span class="sc">$</span>orig_pm), <span class="dv">2</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>pm_mean <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">mean</span>(airport_pm<span class="sc">$</span>orig_pm), <span class="dv">2</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>pm_sd <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">sd</span>(airport_pm<span class="sc">$</span>orig_pm), <span class="dv">2</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"The min is:  "</span>, <span class="fu">format</span>(pm_min, <span class="at">nsmall=</span><span class="dv">2</span>, <span class="at">big.mark=</span><span class="st">","</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The min is:   11.00"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"The max is : "</span>, <span class="fu">format</span>(pm_max, <span class="at">nsmall=</span><span class="dv">2</span>, <span class="at">big.mark=</span><span class="st">","</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The max is :  28,370,758.00"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"The mean is: "</span>, <span class="fu">format</span>(pm_mean, <span class="at">nsmall=</span><span class="dv">2</span>, <span class="at">big.mark=</span><span class="st">","</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The mean is:  1,783,930.78"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"The std dev: "</span>, <span class="fu">format</span>(pm_sd, <span class="at">nsmall=</span><span class="dv">2</span>, <span class="at">big.mark=</span><span class="st">","</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The std dev:  4,522,865.74"</code></pre>
</div>
</div>
<p>The next few code blocks create and test out some (too) simple calibrations of the Pareto distribution.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>pareto_PDF <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">x_m =</span> <span class="dv">2</span>, <span class="at">a =</span> <span class="dv">6</span>){</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>((a<span class="sc">*</span>x_m<span class="sc">^</span>a)<span class="sc">/</span>(x<span class="sc">^</span>(a<span class="sc">+</span><span class="dv">1</span>)))</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>pareto_CDF <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">x_m =</span> <span class="dv">2</span>, <span class="at">a =</span> <span class="dv">6</span>){</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="dv">1</span> <span class="sc">-</span> (x_m<span class="sc">/</span>x)<span class="sc">^</span>a)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>calibrated_PDF <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">pareto_PDF</span>(x, pm_min, pm_mean<span class="sc">/</span>(pm_mean <span class="sc">-</span> pm_min)))</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>calibrated_CDF <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">pareto_CDF</span>(x, pm_min, pm_mean<span class="sc">/</span>(pm_mean<span class="sc">-</span>pm_min)))</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(calibrated_CDF, <span class="at">from =</span> pm_min, <span class="at">to =</span> pm_max<span class="sc">*</span><span class="fl">0.7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="calibrate_airport_size_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(calibrated_PDF, <span class="at">from =</span> pm_min, <span class="at">to =</span> pm_max)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="calibrate_airport_size_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Due to the extreme degree of skew, the full shape of the distribution/density is hard to recognize without limiting the support.</p>
</section>
<section id="gamma-distribution-fit" class="level3">
<h3 class="anchored" data-anchor-id="gamma-distribution-fit">Gamma Distribution Fit</h3>
<p>The Gamma distribution has some additional flexibility and we can use the sample moments to estimate the population parameters and moments. We can try out three relatively simple methods. The first two are more statistically typical, while the third is intended to get a density plot that is on scale with the data while also mimicking its shape at lower values (i.e., a nonzero mode not equal to the mean).</p>
<ol type="1">
<li>Maximum Likelihood</li>
<li>Method of Moments</li>
<li>Mean &amp; Mode System</li>
</ol>
<p><strong>Maximum Likelihood</strong> on the Gamma distribution doesn’t have closed form solutions for the two primary parameters <span class="math inline">\((k, \theta)\)</span>, but some <em>consistent</em> closed form estimators for the generalized gamma distribution could be a reasonable approximation.</p>
<p><span class="math display">\[
\hat{\theta}_{ml} = N^{-1}\sum_{i=1}^{N} x_i \ln(x_i) - \left(N^{-1}\sum_{i=1}^{N} x_i\right) \cdot \left( N^{-1}\sum_{i=1}^{N} \ln(x_i) \right)
\]</span></p>
<p>The ML estimator is biased but can be mostly corrected by scaling it by <span class="math inline">\(N/(N-1)\)</span>. The shape parameter <span class="math inline">\(k\)</span> is then estimated with the approximations <span class="math inline">\(\hat{k}_{ml} = \bar{x} / \hat{\theta}_{ml}\)</span> but the bias-correction is recommended as below.</p>
<p><span class="math display">\[
\hat{k}_{ml}^{*} = \hat{k}_{ml} - \frac{1}{N}\left(3 \hat{k}_{ml} - \frac{2}{3}\cdot \frac{\hat{k}_{ml}}{1 + \hat{k}_{ml}} - \frac{4}{5} \frac{\hat{k}_{ml}}{(1 + \hat{k}_{ml})^2} \right)
\]</span></p>
<p><strong>Method of Moments</strong> on the Gamma distribution has more closed form expressions and when performed using the first to moments about the mean yields estimators:</p>
<p><span class="math display">\[
\begin{align}
\hat{\alpha}_{mom} &amp;= \frac{\bar{x}^2}{N^{-1}(\sum_{i=1}^{N} x_i - \bar{x})^2} \\
\hat{k}_{mom} &amp;= \hat{\alpha}_{mom} \\
\hat{\beta}_{mom} &amp;= \frac{\bar{x}}{N^{-1}(\sum_{i=1}^{N} x_i - \bar{x})^2} \\
\hat{\theta}_{mom} &amp;= \frac{1}{\hat{\beta}_{mom}}
\end{align}
\]</span></p>
<p>The estimates of <span class="math inline">\(\hat{\theta}_{mom}\)</span> and <span class="math inline">\(\hat{k}_{mom}\)</span> can be used as the scale and shape parameters, respectively.</p>
<p><strong>Mean &amp; Mode System of Equations</strong></p>
<p>This is more of a “fitting” than an estimation, but using the expressions for the mean and mode of the gamma distribution and assigning them equal to the empirical values from the sample we can solve the system of equations to arrive at <span class="math inline">\(k\)</span> and <span class="math inline">\(\theta\)</span> values that yield a scale and shape roughly similar to the data, if we prioritize the shape having a mode greater than the minimum value. Letting <span class="math inline">\(\bar{x}\)</span> and <span class="math inline">\(x_m\)</span> be the sample mean and mode respectively we have</p>
<p><span class="math display">\[
\begin{align}
k\theta &amp;= \bar{x} \\
(k - 1)\theta &amp;= x_{m}, \;\; k &gt; 1
\end{align}
\]</span></p>
<p>Solving the simultaneous system for <span class="math inline">\((k,\theta)\)</span> yields</p>
<p><span class="math display">\[
\begin{align}
\hat{k}_{mm} &amp;= \frac{\bar{x}}{\bar{x} - x_m} \\
\hat{\theta}_{mm} &amp;= \bar{x} - x_m
\end{align}
\]</span></p>
<p>The estimates for each approach are computed in the code block below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>airport_pm <span class="sc">%&gt;%</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lnx =</span> <span class="fu">log</span>(orig_pm)) <span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xlnx =</span> orig_pm <span class="sc">*</span> lnx) <span class="ot">-&gt;</span> pm_gam</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>bar_x <span class="ot">&lt;-</span> <span class="fu">mean</span>(pm_gam<span class="sc">$</span>orig_pm)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>bar_lnx <span class="ot">&lt;-</span> <span class="fu">mean</span>(pm_gam<span class="sc">$</span>lnx)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>bar_xlnx <span class="ot">&lt;-</span> <span class="fu">mean</span>(pm_gam<span class="sc">$</span>xlnx)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>v_x <span class="ot">&lt;-</span> <span class="fu">mean</span>((pm_gam<span class="sc">$</span>orig_pm <span class="sc">-</span> bar_x)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="fu">nrow</span>(pm_gam)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Maximum likelihood *like* consistent closed form estimators</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="co"># derived from likelihood of the generalized gamma distribution</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>ml_theta_hat <span class="ot">&lt;-</span> bar_xlnx <span class="sc">-</span> bar_x <span class="sc">*</span> bar_lnx</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>ml_theta_hat <span class="ot">&lt;-</span> (N <span class="sc">/</span> (N <span class="sc">-</span> <span class="dv">1</span>)) <span class="sc">*</span> ml_theta_hat</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>ml_k_hat <span class="ot">&lt;-</span> bar_x <span class="sc">/</span> ml_theta_hat</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>ml_k_hat <span class="ot">&lt;-</span> ml_k_hat <span class="sc">-</span> (<span class="dv">1</span><span class="sc">/</span>N)<span class="sc">*</span>(<span class="dv">3</span><span class="sc">*</span>ml_k_hat <span class="sc">-</span> (<span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>)<span class="sc">*</span>(ml_k_hat<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>ml_k_hat)) <span class="sc">-</span> (<span class="dv">4</span><span class="sc">/</span><span class="dv">5</span>)<span class="sc">*</span>(ml_k_hat<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>ml_k_hat)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>ml_mode_hat <span class="ot">&lt;-</span> (ml_k_hat <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> ml_theta_hat</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Method of moments estimation of gamma distribution</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>mom_alpha_hat <span class="ot">&lt;-</span> (bar_x)<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> v_x</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>mom_k_hat <span class="ot">&lt;-</span> mom_alpha_hat</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>mom_beta_hat <span class="ot">&lt;-</span> (bar_x) <span class="sc">/</span> v_x</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>mom_theta_hat <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> mom_beta_hat</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>mom_mode_hat <span class="ot">&lt;-</span> (mom_k_hat <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> mom_theta_hat</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Mean and Mode Calibration</span></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">density</span>(airport_pm<span class="sc">$</span>orig_pm)</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>mm_mode <span class="ot">&lt;-</span> d<span class="sc">$</span>x[d<span class="sc">$</span>y <span class="sc">==</span> <span class="fu">max</span>(d<span class="sc">$</span>y)]</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>mm_k_hat <span class="ot">&lt;-</span> bar_x <span class="sc">/</span> (bar_x <span class="sc">-</span> mm_mode)</span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>mm_theta_hat <span class="ot">&lt;-</span> bar_x <span class="sc">-</span> mm_mode</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For each of the three approaches, the relevant parameter estimates are printed out along with some of the implied distribution properties.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"MAXIMUM LIKELIHOOD"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "MAXIMUM LIKELIHOOD"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Theta :"</span>, <span class="fu">format</span>(ml_theta_hat, <span class="at">nsmall=</span><span class="dv">2</span>, <span class="at">big.mark=</span><span class="st">","</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Theta : 9,037,721.92"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"k :"</span>, <span class="fu">format</span>(ml_k_hat)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "k : 0.1969823"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"------ IMPLIED PROPERTIES --------"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "------ IMPLIED PROPERTIES --------"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Mean:"</span>, <span class="fu">format</span>(ml_k_hat <span class="sc">*</span> ml_theta_hat, <span class="at">nsmall=</span><span class="dv">2</span>, <span class="at">big.mark=</span><span class="st">","</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Mean: 1,780,271.20"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"StDev:"</span>, <span class="fu">format</span>(<span class="fu">sqrt</span>(ml_k_hat <span class="sc">*</span> (ml_theta_hat)<span class="sc">^</span><span class="dv">2</span>), <span class="at">nsmall=</span><span class="dv">2</span>, <span class="at">big.mark=</span><span class="st">","</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "StDev: 4,011,183.87"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Mode:"</span>, <span class="fu">format</span>(<span class="fu">ifelse</span>(ml_k_hat<span class="sc">&gt;=</span><span class="dv">1</span>,(ml_k_hat<span class="dv">-1</span>)<span class="sc">*</span>ml_theta_hat, <span class="dv">0</span>), <span class="at">nsmall=</span><span class="dv">2</span>, <span class="at">big.mark=</span><span class="st">","</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Mode: 0.00"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"METHOD OF MOMENTS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "METHOD OF MOMENTS"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Theta :"</span>, <span class="fu">format</span>(mom_theta_hat, <span class="at">nsmall=</span><span class="dv">2</span>, <span class="at">big.mark=</span><span class="st">","</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Theta : 11,454,511.24"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"k :"</span>, <span class="fu">format</span>(mom_k_hat)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "k : 0.1557405"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"------ IMPLIED PROPERTIES --------"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "------ IMPLIED PROPERTIES --------"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Mean:"</span>, <span class="fu">format</span>(mom_k_hat <span class="sc">*</span> mom_theta_hat, <span class="at">nsmall=</span><span class="dv">2</span>, <span class="at">big.mark=</span><span class="st">","</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Mean: 1,783,930.78"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"StDev:"</span>, <span class="fu">format</span>(<span class="fu">sqrt</span>(mom_k_hat <span class="sc">*</span> (mom_theta_hat)<span class="sc">^</span><span class="dv">2</span>), <span class="at">nsmall=</span><span class="dv">2</span>, <span class="at">big.mark=</span><span class="st">","</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "StDev: 4,520,404.32"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Mode:"</span>, <span class="fu">format</span>(<span class="fu">ifelse</span>(mom_k_hat<span class="sc">&gt;=</span><span class="dv">1</span>,(mom_k_hat<span class="dv">-1</span>)<span class="sc">*</span>mom_theta_hat, <span class="dv">0</span>), <span class="at">nsmall=</span><span class="dv">2</span>, <span class="at">big.mark=</span><span class="st">","</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Mode: 0.00"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"MEAN &amp; MODE FIX"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "MEAN &amp; MODE FIX"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Theta :"</span>, <span class="fu">format</span>(mm_theta_hat, <span class="at">nsmall=</span><span class="dv">2</span>, <span class="at">big.mark=</span><span class="st">","</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Theta : 1,727,595.34"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"k :"</span>, <span class="fu">format</span>(mm_k_hat)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "k : 1.032609"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"------ IMPLIED PROPERTIES --------"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "------ IMPLIED PROPERTIES --------"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Mean:"</span>, <span class="fu">format</span>(mm_k_hat <span class="sc">*</span> mm_theta_hat, <span class="at">nsmall=</span><span class="dv">2</span>, <span class="at">big.mark=</span><span class="st">","</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Mean: 1,783,930.78"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"StDev:"</span>, <span class="fu">format</span>(<span class="fu">sqrt</span>(mm_k_hat <span class="sc">*</span> (mm_theta_hat)<span class="sc">^</span><span class="dv">2</span>), <span class="at">nsmall=</span><span class="dv">2</span>, <span class="at">big.mark=</span><span class="st">","</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "StDev: 1,755,537.10"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Mode:"</span>, <span class="fu">format</span>(<span class="fu">ifelse</span>(mm_k_hat<span class="sc">&gt;=</span><span class="dv">1</span>,(mm_k_hat<span class="dv">-1</span>)<span class="sc">*</span>mm_theta_hat, <span class="dv">0</span>), <span class="at">nsmall=</span><span class="dv">2</span>, <span class="at">big.mark=</span><span class="st">","</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Mode: 56,335.44"</code></pre>
</div>
</div>
<p>From the above print outs, we see that the means are pretty comparable across all methods. The spread, as measured by standard deviation, is similar for maximum likelihood and method of moments which makes sense given the actual estimation. The mean and mode method has a very different spread, which could affect results, but it is the only one of the three approaches that yields a positive mode (since <span class="math inline">\(\hat{k}_mm &gt; 1\)</span>.</p>
<p>Using the mean and mode approach we can calibrate the gamma PDF and CDF as shown below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>gamma_pdf <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dgamma</span>(x, <span class="at">shape =</span> ml_k_hat, <span class="at">scale =</span> ml_theta_hat)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>gamma_cdf <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pgamma</span>(x, <span class="at">shape =</span> mm_k_hat, <span class="at">scale =</span> mm_theta_hat)</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(gamma_pdf, <span class="at">from=</span><span class="dv">0</span>, <span class="at">to=</span>pm_max)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="calibrate_airport_size_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="enplanements" class="level3">
<h3 class="anchored" data-anchor-id="enplanements">Enplanements</h3>
<p>Another way to measure the size of an airport may be “enplanements” which I think means how many people it got onto planes. This data is contained in some airport financials and I will look at it here based on a smaller sample of airports to see what distribution seems to make sense. While enplanements are good for measuring a single airport’s size, its not as easily calculated from flight data and flight miles or revenue passenger-miles. Additionally, this particular data set comes from voluntarily self-reported data. Consequently, data is too frequently missing and it’s accuracy may not always be accurate.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>fin <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">"../data/airports/airport_financials.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>How many unique airport codes are listed with positive enplanement numbers?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>fin <span class="sc">%&gt;%</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Enplanements <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Enplanements) <span class="sc">%&gt;%</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dim</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 281   1</code></pre>
</div>
</div>
<p>Apparently, there are only 281 airports reporting positive enplanements. I will assume that any zero values for enplanements are mistakes, or indicative of missing data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">filter</span>(fin, Enplanements <span class="sc">&gt;</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> Enplanements)) <span class="sc">+</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribution of reported enplanements"</span>,</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Enplanements"</span>,</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Density"</span>) <span class="sc">+</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_clean</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="calibrate_airport_size_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>
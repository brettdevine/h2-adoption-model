<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Network Effects Fixed Point Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="nash_equilibrium_plots_files/libs/clipboard/clipboard.min.js"></script>
<script src="nash_equilibrium_plots_files/libs/quarto-html/quarto.js"></script>
<script src="nash_equilibrium_plots_files/libs/quarto-html/popper.min.js"></script>
<script src="nash_equilibrium_plots_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="nash_equilibrium_plots_files/libs/quarto-html/anchor.min.js"></script>
<link href="nash_equilibrium_plots_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="nash_equilibrium_plots_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="nash_equilibrium_plots_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="nash_equilibrium_plots_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="nash_equilibrium_plots_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Network Effects Fixed Point Analysis</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="network-effects-equilibrium" class="level2">
<h2 class="anchored" data-anchor-id="network-effects-equilibrium">Network Effects Equilibrium</h2>
<p>This notebook creates a calibrated model and computes the associated Nash equilibria (if any) and generates plots showing the equilibria and the path dynamics. For example, if no positive equilibrium exist, it will show the theoretical adoption curve and the single equilibrium at zero adoption. If there are positive equilibria, then the graph will show the three Nash equilibria of the model: low, tipping, and high. The graph will then show the recursive dynamics of the adoption curve. For any initial point below the tipping point equilibrium, recursive application of the adoption decision of airports will drive the system to the zero adoption equilibrium.</p>
<p>Below we have two example plots when there are positive adoption equilibrium. The first is the result of the function <code>ne_simple_plot()</code> and the second shows the recursive dynamics of the system detailing how it moves from one equilibrium to another along the adoption curve and is generated by a function called <code>ne_plot_recursive()</code> .</p>
<p><img src="images/simple_ne_plot_example.png" class="img-fluid"></p>
<p><img src="images/ne-plot-recursive_example.png" class="img-fluid"></p>
<p>Following the plots, there is some additional code setup to analyze the properties of the chosen model calibration to debug issues.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove all items from memory</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Temporarily set the working directory</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># to load source code files.</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">"../src/"</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"h2_adopt_model.R"</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"h2_adopt_model_plots.R"</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the necessary libraries</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggthemes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="define-calibrated-distribution-of-airport-sizes" class="level3">
<h3 class="anchored" data-anchor-id="define-calibrated-distribution-of-airport-sizes">Define Calibrated Distribution of Airport Sizes</h3>
<p>The first step is to calibrate the function that will be used as the CDF for the distribution of airport sizes in the model. Carrying over estimates from the <code>calibration_airport_size.qmd</code> notebook we specify the function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define distribution of airport sizes</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Focusing on origin passenger miles and removing</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># outliers (1.5 x interquartile range) we have</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># the following, where Q_min is set artificially low</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># since its close Q_min = 11.</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>Q_min <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>Q_max <span class="ot">&lt;-</span>  <span class="dv">85534859450</span> <span class="co">#1917009.00</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>Q_mean <span class="ot">&lt;-</span> <span class="dv">999469355</span> <span class="co"># 197069.96</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>Q_mode <span class="ot">&lt;-</span> <span class="fl">8683.595</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Gamma Distribution Parameters</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Current parameters from mode-mean calibration</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>theta <span class="ot">=</span> <span class="fl">1727595.34</span> <span class="co">#188386.36</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>k <span class="ot">=</span> <span class="fl">1.032609</span> <span class="co">#1.046095</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>pareto_cdf <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">x_m =</span> <span class="dv">2</span>, <span class="at">a =</span> <span class="dv">6</span>){</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="dv">1</span> <span class="sc">-</span> (x_m<span class="sc">/</span>x)<span class="sc">^</span>a)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>calibrated_pareto_cdf <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">pareto_cdf</span>(x, Q_min, Q_mean<span class="sc">/</span>(Q_mean<span class="sc">-</span>Q_min)))</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>calibrated_gamma_pdf <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dgamma</span>(x, <span class="at">shape =</span> k, <span class="at">scale =</span> theta)</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>calibrated_gamma_cdf <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pgamma</span>(x, <span class="at">shape =</span> k, <span class="at">scale =</span> theta)</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="define-the-model" class="level3">
<h3 class="anchored" data-anchor-id="define-the-model">Define the Model</h3>
<p>In the code below we will define a model. A model has two general components.</p>
<ol type="1">
<li>A dataframe object with a column for each of the parameters. The dataframe must have at least one row, but there exist functions in the source code which will allow the dataframe to have many rows to simulate different models, or models over time. The names of the parameters must be specified exactly as shown.</li>
<li>A function representing the CDF of the airport size distribution.</li>
</ol>
<p>These two components will be combined in a named list with the following required names:</p>
<ul>
<li><p>The dataframe of parameters must be named “model_params”.</p></li>
<li><p>The function for the airport size CDF must be named “cdf”.</p></li>
</ul>
<p>The model below shows one particular calibration. It does not currently result in any positive adoption equilibrium. Several factors must be adjusted significantly to get adoption to occur.</p>
<p>We will create a set of model parameters that are calibrated to reflect the current reality as much as possible.</p>
<p>For clarity, the key model parameters aside from the CDF are:</p>
<ul>
<li><p><code>"p_h"</code>: Relative price of LH2 to kerosene-based jet fuel faced by airlines</p></li>
<li><p><code>"f_k_rev"</code>: Millions USD operating revenue per passenger-mile for jet fuel</p></li>
<li><p><code>"f_k_exp"</code>: Millions USD operating expenses per passenger-mile for jet fuel</p></li>
<li><p><code>"f_h_rev</code>“: Operating revenue per passenger-mile for hydrogen relative to jet fuel. Value of 1 implies the same revenue per passenger-mile as jet fuel, 1.2 is 1.2 times that of jet fuel, i.e., 20% higher. While 0.85 would imply hydrogen operating revenues per passenger-mile are 85% (15% lower) of that for jet fuel.</p></li>
<li><p><code>"f_h_exp"</code>: Operating expense per passenger-mile for hydrogen relative to jet fuel. Same logic as relative operating revenue.</p></li>
<li><p><code>"delta"</code>: Discount rate in <span class="math inline">\((0,1)\)</span> to applied to benefits and costs occurring in the future. Typically the weighted average cost of capital to the airport is used as a measure here. But higher values can imply greater “impatience”, while lower values imply greater “patience”.</p></li>
<li><p><code>"gamma"</code>: Growth rate in <span class="math inline">\([0, \delta)\)</span> is the rate at which operating revenues and expenses are expected to grow as a whole going into the future. This may be set to zero if we have growth in the individual parameters for revenue and expenses. Or it may be positive and reflect the inflation rate if <span class="math inline">\(\delta\)</span> is the nominal interest rate faced by the airport. This would yield an overall effective discount rate close to the real interest rate.</p></li>
<li><p><code>"x"</code>: The fixed cost portion in Million USD (y-intercept) of the adoption cost function. It is the minimal capital expenditure required for an airport with very small capacity to even get started.</p></li>
<li><p><code>"c_x"</code> : The marginal capital expenditure (cost) in Million USD per kiloton of LH2. <span class="math inline">\(Million\;USD/kt\;LH2\)</span></p></li>
<li><p><code>"eta"</code>: The conversion rate between kilotons of LH2 and passenger-miles. The capital expenditure function derived from the research paper examples takes annual kilotons of LH2 as an input and returns cost in millions. Using annual passenger-miles as our measure of airport size we need to convert this function to annual passenger-miles. <span class="math inline">\(c_x \times \eta = \frac{Million\; USD}{kt\; LH2} \times \frac{kt\; LH2}{pm} = \frac{Million\; USD}{pm}\)</span>.</p></li>
<li><p><code>"nu"</code>: The percent or proportion of an airport’s annual capacity they desire to reflect the capacity of LH2 services they will provide in the future. For example, an airport adopting LH2 may anticipate that demand for LH2 aeronautical services will not reach 100% of their airport’s capacity. So they would have no need to invest in enough infrastructure to meet that demand. Instead, they may anticipate that at most 50% of their annual flight capacity will be demanded in the form of LH2. In such a case we would set <span class="math inline">\(\nu = 0.5\)</span> to reflect that reality in the capital expenditure function when calculating the cost of adoption.</p></li>
<li><p><code>"rho"</code>: A substitution parameter in <span class="math inline">\((0, 1)\)</span> belonging to the airport industry’s production function. As the parameter approaches 1, the inputs of Kerosene/Jetfuel and LH2 become perfect substitutes for one another. This would imply that airlines will simply choose all kerosene or all LH2, whichever is cheapest. As <span class="math inline">\(\rho\)</span> approaches 0, the ability to substitute one input for the other decreases in the production function and at least some positive demand for each should exist. This latter scenario is difficult to imagine as jet fuel is already incorporated into all airports and aircraft. But perhaps in the future other scenarios may arise where some existing airports become hydrogen only, or perhaps new hydrogen-only airports are created and airlines have to demand at least some hydrogen aeronautical services if they want to include that airport in their network. Currently the value has been set to <span class="math inline">\(\rho = 0.5\)</span>.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the model parameters using a dataframe.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>calibrated_model_params <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>      <span class="st">"p_h"</span> <span class="ot">=</span> <span class="fl">1.2</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    , <span class="st">"f_k_rev"</span> <span class="ot">=</span> <span class="fl">0.00000002118861</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    , <span class="st">"f_k_exp"</span> <span class="ot">=</span> <span class="fl">0.00000001871368</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    , <span class="st">"f_h_rev"</span> <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    , <span class="st">"f_h_exp"</span> <span class="ot">=</span> <span class="fl">1.2</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    , <span class="st">"delta"</span> <span class="ot">=</span> <span class="fl">0.04</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    , <span class="st">"gamma"</span> <span class="ot">=</span> <span class="fl">0.02</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    , <span class="st">"x"</span> <span class="ot">=</span> <span class="fl">173.75</span> </span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    , <span class="st">"c_x"</span> <span class="ot">=</span> <span class="fl">2.7031</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    , <span class="st">"eta"</span> <span class="ot">=</span> <span class="fl">0.00000001425</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    , <span class="st">"nu"</span> <span class="ot">=</span> <span class="fl">0.1</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    , <span class="st">"rho"</span> <span class="ot">=</span> <span class="fl">0.5</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    , <span class="st">"q_min"</span> <span class="ot">=</span> Q_min</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    , <span class="st">"q_max"</span> <span class="ot">=</span> Q_max</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    , <span class="st">"q_mean"</span> <span class="ot">=</span> Q_mean</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Model List</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">list</span>(calibrated_model_params,</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>              calibrated_gamma_cdf)</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(model) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"model_params"</span>, <span class="st">"cdf"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After the model list object is created, we can generate some plots as follows:</p>
<ol type="1">
<li>Supply the entire model as an argument to the <code>ne_plot_simple_data()</code> function.</li>
<li>Use the returned data objects from that function and input them as arguments, along with an plot file name, to the <code>ne_plot_simple()</code> function and the graph will be generated and saved in the image directory.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Here we input the model into a helper</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># function which returns the data necessary</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># for plotting the figure.</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>plot_df <span class="ot">&lt;-</span> <span class="fu">ne_plot_simple_data</span>(model)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Pass the two components 1 and 2 of the returned</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># plot data into the simple plot function and specify</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># a name for the </span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ne_plot_simple</span>(plot_df[[<span class="dv">1</span>]], plot_df[[<span class="dv">2</span>]], <span class="st">"simple_ne_plot.pdf"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We do a similar process to obtain the recursive Nash equilibrium plot</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>plot_df2 <span class="ot">&lt;-</span> <span class="fu">ne_plot_recursive_data</span>(model)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ne_plot_recursive</span>(plot_df2, model<span class="sc">$</span>model_params, <span class="st">"ne-plot-recursive.pdf"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1 row containing missing values or values outside the scale range
(`geom_segment()`).</code></pre>
</div>
</div>
</section>
</section>
<section id="trouble-shooting-model-calibration" class="level2">
<h2 class="anchored" data-anchor-id="trouble-shooting-model-calibration">Trouble Shooting Model Calibration</h2>
<p>The process of calibrating the model is difficult, as a delicate balance must be struck to</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>f_k_rev <span class="ot">&lt;-</span> calibrated_model_params<span class="sc">$</span>f_k_rev</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>f_h_rev <span class="ot">&lt;-</span> calibrated_model_params<span class="sc">$</span>f_h_rev</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>f_k_exp <span class="ot">&lt;-</span> calibrated_model_params<span class="sc">$</span>f_k_exp</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>f_h_exp <span class="ot">&lt;-</span> calibrated_model_params<span class="sc">$</span>f_h_exp</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>c_x <span class="ot">&lt;-</span> calibrated_model_params<span class="sc">$</span>c_x</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>eta <span class="ot">&lt;-</span> calibrated_model_params<span class="sc">$</span>eta</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>nu <span class="ot">&lt;-</span> calibrated_model_params<span class="sc">$</span>nu</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>delta <span class="ot">&lt;-</span> calibrated_model_params<span class="sc">$</span>delta</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>gamma <span class="ot">&lt;-</span> calibrated_model_params<span class="sc">$</span>gamma</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> calibrated_model_params<span class="sc">$</span>x</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>operating_profit <span class="ot">&lt;-</span> (f_h_rev <span class="sc">*</span> f_k_rev) <span class="sc">-</span> (f_h_exp <span class="sc">*</span> f_k_exp)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.01</span>)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>cutoff_denom_benefit <span class="ot">&lt;-</span> ((f_h_rev <span class="sc">*</span> f_k_rev) <span class="sc">-</span> (f_h_exp <span class="sc">*</span> f_k_exp)) <span class="sc">*</span> <span class="fu">alpha</span>(s, model<span class="sc">$</span>model_params) <span class="sc">*</span> s</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>cutoff_denom_cost <span class="ot">&lt;-</span> c_x <span class="sc">*</span> eta <span class="sc">*</span> nu <span class="sc">*</span> (delta <span class="sc">-</span> gamma)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>denom <span class="ot">&lt;-</span> cutoff_denom_benefit <span class="sc">-</span> cutoff_denom_cost</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>numer <span class="ot">&lt;-</span> x <span class="sc">*</span> (delta <span class="sc">-</span> gamma)</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>param_test <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="st">"s"</span><span class="ot">=</span>s, </span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"denom_B"</span><span class="ot">=</span>cutoff_denom_benefit,</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"denom_C"</span><span class="ot">=</span>cutoff_denom_cost,</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"denom"</span><span class="ot">=</span>denom,</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"numer"</span><span class="ot">=</span>numer)</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>param_test[<span class="st">"ratio"</span>] <span class="ot">=</span> param_test<span class="sc">$</span>numer <span class="sc">/</span> param_test<span class="sc">$</span>denom</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>param_test[<span class="st">"cutoff"</span>] <span class="ot">=</span> <span class="fu">adoption_cutoff</span>(s, model<span class="sc">$</span>model_params)</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>param_test[<span class="st">"adopt"</span>] <span class="ot">=</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">calibrated_gamma_cdf</span>(param_test<span class="sc">$</span>ratio)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(param_test) <span class="sc">+</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> s, <span class="at">y =</span> denom_B), <span class="at">color =</span> <span class="st">"green"</span>) <span class="sc">+</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> s, <span class="at">y =</span> denom_C), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_clean</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="nash_equilibrium_plots_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">filter</span>(param_test, ratio <span class="sc">&gt;=</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> s, <span class="at">y =</span> ratio), <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> s, <span class="at">y =</span> cutoff), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype=</span><span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> Q_max) <span class="sc">+</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_clean</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="nash_equilibrium_plots_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">filter</span>(param_test, ratio<span class="sc">&gt;</span><span class="dv">0</span> <span class="sc">&amp;</span> ratio <span class="sc">&lt;</span> Q_max)) <span class="sc">+</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> ratio, <span class="at">y =</span> adopt)) <span class="sc">+</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_clean</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="nash_equilibrium_plots_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>plot_df2 <span class="ot">&lt;-</span> <span class="fu">ne_plot_recursive_data</span>(model)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ne_plot_recursive</span>(plot_df2, model<span class="sc">$</span>model_params)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1 row containing missing values or values outside the scale range
(`geom_segment()`).</code></pre>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>